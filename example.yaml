# Top-level YAML entries must contain a type: tag
# that specifies the type of the entry.
#
# Reserved keywords:
#   version: <int>
#      The file format version. This must be a top-level section. Where
#      include directives are present, all included files must have the same
#      version. Where missing, the version number is 1.
#
#   include: path/to/file
#      Includes the given file with the path relative to the current file.
#      Inclusion is in situ, i.e. the location of the include directive
#      matters.
#
#   <section name>:
#      type: [actor|test]
#      See the description below
#
#   extends:
#      Allowed in sections of type actor or test.
#
#   file:
#     <some key>: |
#            some lengthy description of the tests
#
#     A section that describes the file itself. This description will be
#     copied into the resulting markdown file as the Uji section
#     description. The <some key> should be unique to avoid clashes when
#     including other files but it is not otherwise used. Use the filename.
#
#
# The actor type is an entity that a test is performed on.
# Allowed subkeys:
#    extends: inherit all from the referenced section
#    name: a human-readable name for the entity
#    description: a longer description for human consumption
#    tags: a dictionary of key: value that can be used to filter on
#          value must not be a list/dict
#  
# The test type is a description of a test that may produce log files.
# Allowed subkeys:
#    extends: inherit all from the referenced section
#    name: a human-readable name for the test
#    description: a longer description for human consumption
#    filter: a dictionary to filter on. All keys+values of the actor must
#            match the entries in this dictionary.
#            The value must be a list, even if it's just one entry
#            Where the filter tag is missing, this test is assumed
#            to be run only once.
#    tests: a list of instruction strings describing the tests to be
#           performed.
#    files: a list of files to collect
#    commands: a list of commands to run, each command has two keys:
#       run: the command to invoke
#       description: a description for human consumption
#       output: {single|multi|attach|exitcode|human}
#         value 'single' (default): the output is a single line
#         value 'multi': the output is multiple lines
#         value 'attach': the output should be attached as file
#         value 'exitcode': the output is the exit code of the command
#         value 'human': the output depends on human-interpretation
version: 1

file:
    example.yaml: |
        This is an example yaml file. The text here is used as the file
        description in the generated markdown file.
  
generic_laptop_keyboard:
  type: actor
  name: AT Translated Keyboard
  description: the PS/2 thing with keys as found in laptops
  # tags is a dictionary of entries that the tests can later be filtered on
  # The keys are free-form.
  tags:
    bus: PS/2

# inherits everything from above but overwrites the tags
generic_usb_keyboard:
  extends: generic_laptop_keyboard
  name: External USB Keyboard
  description: A USB keyboard
  tags:
    bus: USB

amd_picasso:
  type: actor
  name: AMD
  tags:
    vendor: amd
    type: videocard

# A set of test instructions. The filter argument
# means this will be applied to anything with a bus of USB and/or PS/2.
test_keyboard:
  type: test
  filter:
    bus:
      - PS/2
      - USB
  tests:
    - make sure we can type keys
    - kbd LEDs

test_usb_keyboards:
  type: test
  filter:
    bus: USB
  tests:
    - plug and unplug the keyboard

test_general:
  type: test
  name: General
  tests:
    - hid-tools test suite

test_system:
  type: test
  name: System Sanity Checks
  tests:
    - kernel not tainted on boot

test_hotplug:
  type: test
  filter:
    # special value __any__ means any value for that key
    bus: [__any__]
  tests:
    - unplugging shows `DEVICE_ADDED`/`DEVICE_REMOVED` events
  logs:
      commands:
        - run: dmesg
          output: attach
          description: collect dmesg after plug/unplug

test_usb_logs:
  type: test
  filter:
    bus: [USB]
  tests:
    - check lsusb after plugin
  logs:
    commands:
      - run: lsusb -v
        output: attach

# A test without a 'tests' entry just collects logs
log_input_devices:
  type: test
  logs:
      files:
        - /proc/bus/input/devices
      commands:
        - run: evtest
          output: attach

log_version:
  type: test
  logs:
      commands:
        - run: my-command --version
          output: single

log_some_check:
  type: test
  logs:
      files:
        - /path/to/testsuite.output
      commands:
        - run: some-command
          output: exitcode

log_gtk:
  type: test
  logs:
      commands:
        - run: gnome-control-center
          output: human
          description: check scrolling works in the test area


test_suspend_resume:
  type: test
  name: Normal suspend/resume test
  filter:
    type: videocard
  description: |
    This test checks behavior of a **normal** suspend/resume cycle.

    Setup:
    - suspend the machine
    - resume the machine
    Machine must be connected to power during this test.
  tests:
    - machine must not freeze or crash
    - all monitors (including dock) turn back on on resume
    - dmesg is free of obvious errors or warnings
  logs:
    commands:
    - run: dmesg

test_hotplug_video:
  type: test
  name: Video card hotplugging test
  filter:
    type: videocard
  description: |
    Setup:
    - machine must be connected to power
    - put on a rubber suit and rubber gloves
    - rip the card out of the machine
    - extinguish any fire caused by the sparks
  tests:
    - machine has shut down
    - building is on fire
